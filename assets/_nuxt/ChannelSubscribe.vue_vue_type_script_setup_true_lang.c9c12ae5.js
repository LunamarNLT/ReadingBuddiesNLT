import V from"./InputText.0abbd94c.js";import{_ as $}from"./Field.vue_vue_type_script_setup_true_lang.2cfdd881.js";import{_ as F}from"./DataField.vue_vue_type_script_setup_true_lang.e4b17d1e.js";import{u as I}from"./useToastMessage.bad030a2.js";import{a as U,I as E,f as Y,J as H,v as b,z as j,o as n,h as f,i as s,j as i,c as _,s as c,u as a,w as z,m as A,K as G,L as J,r as y,M as L,t as Q}from"./entry.86b9e19f.js";import K from"./ReplyCommandMessage.a7208ca2.js";import O from"./ReplyQueryMessage.6c0c2dd1.js";const P={class:"grid-nogutter grid col-12 p-0"},W={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},X={class:"flex flex-grow-1 align-items-end p-0"},Z={class:"align-items-end grid p-fluid col-11 pb-0 mb-1"},ee={class:"col-12 md:col-2 pt-0"},se={class:"col-12 md:col-2 pt-0"},oe={class:"col-12 md:col-2 pt-0"},le={class:"col-12 md:col-2 pt-0"},ae={class:"mb-3"},te={class:"flex justify-content-end",style:{"min-width":"10rem"}},ne={key:0,class:"col-12 md:12 pt-3"},ie={class:"pt-0 pl-1 pr-1 pb-3 mt-2"},ce={key:0,class:"grid formgrid p-fluid mt-3"},de={class:"grid formgrid p-fluid col-12 md:col-12 p-1"},re={class:"col-12 md:col-6"},ue={class:"col-12 md:col-6"},pe={class:"col-12 md:col-6 p-1"},me={class:"col-12 md:col-6 p-1"},ve={class:"col-12 md:col-12 p-1"},ke=U({__name:"ChannelSubscribe",props:{channel:{type:String,default:()=>""},type:{type:String,default:()=>""}},setup(w){const r=w;E(()=>{e.value=void 0,o.value&&h()});const g=Y(),{ApiBaseHost:k}=H();let e=b(void 0),u=j({});const o=b(!1),t=b(!1),p=b(""),C=I(),x=()=>{let l=`channel=${r.channel}`;return r.type==="commands"?l+="&subscribe_type=commands":l+="&subscribe_type=queries",p.value!==""&&(l+=`&group=${p.value}`),`ws://${k.value}/api/subscribe/cqrs?${l}`},S=()=>{u=G(x(),{autoClose:!1,immediate:!1,onConnected:()=>{o.value=!0,t.value=!1,e.value=void 0},onDisconnected:()=>{o.value=!1,t.value=!1},onError:(l,d)=>{o.value=!1,t.value=!1,C.showError("Error occurred while subscribing to channel "+r.type+":"+r.channel)},onMessage:(l,d)=>{o.value=!0,t.value=!1,e.value=JSON.parse(d.data)}}),t.value=!0,u.open()},h=()=>{t.value=!1,u&&u.close()},M=()=>{e.value=void 0},N=()=>{e.value.isCommand?g.open(K,{props:{header:"Reply Command",style:{width:"30vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:e.value},onClose:()=>{e.value=void 0}}):g.open(O,{props:{header:"Reply Query",style:{width:"50vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:e.value},onClose:()=>{e.value=void 0}})},q=l=>l===0?"N/A":J(l).format("YYYY-MM-DD HH:mm:ss");return(l,d)=>{const B=V,m=y("Button"),D=y("Tag"),v=$,R=F;return n(),f("div",P,[s("div",W,[s("div",X,[s("div",Z,[s("div",ee,[i(B,{modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=T=>p.value=T),label:"Set Group Name",disabled:o.value,placeholder:"No Group"},null,8,["modelValue","disabled"])]),s("div",se,[o.value?c("",!0):(n(),_(m,{key:0,label:"Subscribe",class:"button-grey",icon:"pi pi-angle-double-down",onClick:S,disabled:t.value},null,8,["disabled"])),o.value?(n(),_(m,{key:1,label:"Unsubscribe",class:"button-grey",icon:"pi pi-angle-double-up",onClick:h,disabled:t.value},null,8,["disabled"])):c("",!0)]),s("div",oe,[o.value?(n(),_(m,{key:0,label:"Reply",class:"button-grey",icon:"pi pi-reply",onClick:N,disabled:a(e)===void 0},null,8,["disabled"])):c("",!0)]),s("div",le,[o.value?(n(),_(m,{key:0,label:"Skip Next",class:"button-grey",icon:"pi pi-step-forward-alt",onClick:M,disabled:a(e)===void 0},null,8,["disabled"])):c("",!0)])])]),s("div",ae,[s("div",te,[i(D,{class:A(["text-sm border-round-xl font-italic font-light mr-1",o.value?"bg-success":"bg-error"])},{default:z(()=>[L(Q(o.value?"Subscribed":"Unsubscribed"),1)]),_:1},8,["class"])])])]),a(e)?(n(),f("div",ne,[s("div",ie,[a(e).requestId!==""?(n(),f("div",ce,[s("div",de,[s("div",re,[i(v,{label:"Request Id",value:a(e).requestId},null,8,["value"])]),s("div",ue,[i(v,{label:"Timestamp",value:q(a(e).timestamp)},null,8,["value"])])]),s("div",pe,[i(v,{label:"Metadata",value:a(e).metadata},null,8,["value"])]),s("div",me,[i(v,{label:"Tags",value:a(e).tags},null,8,["value"])]),s("div",ve,[i(R,{label:"Body",value:a(e).body,styleProp:"height: 32vh"},null,8,["value"])])])):c("",!0)])])):c("",!0)])}}});export{ke as _};
