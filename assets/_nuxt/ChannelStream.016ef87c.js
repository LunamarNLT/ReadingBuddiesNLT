var U=Object.defineProperty;var z=(e,a,t)=>a in e?U(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var o=(e,a,t)=>(z(e,typeof a!="symbol"?a+"":a,t),t);import{_ as H}from"./Field.vue_vue_type_script_setup_true_lang.8447d9ba.js";import{_ as P}from"./DataField.vue_vue_type_script_setup_true_lang.e7665b77.js";import{c as G,f as K,d as L}from"./stream.38699bf4.js";import{u as X}from"./useToastMessage.5053bbd0.js";import{a as Y,s as y,e as Z,Q as M,o as c,f as x,h as i,l as Q,u as s,i as r,c as v,a2 as q,q as l,w as f,R as T,t as V,r as j,p as ee,j as te,k as se}from"./entry.53b34a98.js";import"./StatStripCard.vue_vue_type_style_index_0_scoped_b87ef05f_lang.52c9345e.js";class ne{constructor(){o(this,"requestType");o(this,"channel");o(this,"visibilitySeconds");o(this,"waitSeconds");o(this,"refSequence");this.requestType="stream_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=0}setChannel(a){return this.channel=a,this}setVisibilitySeconds(a){return this.visibilitySeconds=a,this}setWaitSeconds(a){return this.waitSeconds=a,this}}class ae{constructor(a){o(this,"requestType");o(this,"channel");o(this,"visibilitySeconds");o(this,"waitSeconds");o(this,"refSequence");this.requestType="ack_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=a}}class ie{constructor(a){o(this,"requestType");o(this,"channel");o(this,"visibilitySeconds");o(this,"waitSeconds");o(this,"refSequence");this.requestType="reject_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=a}}var D=(e=>(e[e.Disconnected=0]="Disconnected",e[e.Connected=1]="Connected",e[e.StartTransaction=2]="StartTransaction",e[e.InTransaction=3]="InTransaction",e[e.EndTransaction=4]="EndTransaction",e[e.TransactionExpired=5]="TransactionExpired",e))(D||{}),d=(e=>(e[e.Connect=0]="Connect",e[e.Disconnect=1]="Disconnect",e[e.StartTransaction=2]="StartTransaction",e[e.InTransaction=3]="InTransaction",e[e.TransactionComplete=4]="TransactionComplete",e[e.TransactionExpired=5]="TransactionExpired",e))(d||{});const oe=[{state:0,event:0,nextState:1},{state:0,event:1,nextState:0},{state:1,event:2,nextState:2},{state:2,event:3,nextState:3},{state:3,event:4,nextState:1},{state:3,event:5,nextState:5},{state:5,event:4,nextState:1},{state:5,event:1,nextState:0},{state:1,event:1,nextState:0},{state:2,event:1,nextState:0},{state:3,event:1,nextState:0},{state:2,event:0,nextState:1}];class ce{constructor(a,t,m){o(this,"state");o(this,"event");o(this,"nextState");this.state=a,this.event=t,this.nextState=m}transition(a){const t=oe.find(m=>m.state===this.state&&m.event===a);return t&&(this.state=t.nextState),this.state}isConnected(){return this.state===1}isDisconnected(){return this.state===0}isInTransaction(){return this.state===3}isStartTransaction(){return this.state===2}isEndTransaction(){return this.state===4}isTransactionExpired(){return this.state===5}isTransaction(){return this.isStartTransaction()||this.isInTransaction()||this.isEndTransaction()}}class le{static create(a,t,m){return new ce(a,t,m)}}const re=e=>(ee("data-v-42a5db7b"),e=e(),te(),e),de={class:"grid-nogutter grid col-12 p-0"},ue={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},ve={class:"flex flex-grow-1 align-items-end p-0"},me={class:"align-items-end grid p-fluid col-7 pb-0 mb-1"},pe=re(()=>i("label",{class:"text-sm ml-1 font-medium",for:"messages"},"Visibility in Seconds",-1)),he={class:"col-12 md:col-3 pt-0"},_e={key:0,class:"col-12 md:col-3 pt-0"},be={key:1,class:"col-12 md:col-3 pt-0"},fe={key:2,class:"col-12 md:col-3 pt-0"},Te={class:"mb-2",style:{"min-width":"15rem"}},ye={class:"flex justify-content-end"},xe={key:0,class:"col-12 md:12 pt-3"},ge={class:"pt-0 pl-1 pr-1 pb-3"},Se={key:0,class:"grid formgrid p-fluid mt-3"},ke={class:"col-12 md:col-3 p-1"},Ce={class:"col-12 md:col-3 p-1"},qe={class:"col-12 md:col-3 p-1"},we={class:"col-12 md:col-3 p-1"},Ie={class:"col-12 md:col-3 p-1"},De={class:"col-12 md:col-3 p-1"},Ee={class:"col-12 md:col-3 p-1"},Re={class:"col-12 md:col-3 p-1"},Ne={class:"col-12 md:col-6 p-1"},Ve={class:"col-12 md:col-6 p-1"},je={class:"col-12 md:col-12 p-1"},Fe=Y({__name:"ChannelStream",props:{channel:{type:String,default:()=>""}},setup(e){const a=e;let t=y(void 0);const{ApiBaseHost:m}=G();Z();const h=y(0),{pause:w,resume:F,isActive:Ae}=K(()=>{h.value>0?h.value--:w()},1e3);let n=y(le.create(D.Disconnected,d.Connect,D.Connected));M(()=>{E()});const g=X(),S=y(60),A=y(3600),_=y(0),k=L(`ws://${m.value}/api/stream_queue_messages`,{autoClose:!1,immediate:!1,onConnected:()=>{n.value.transition(d.Connect),I()},onDisconnected:()=>{n.value.transition(d.Disconnect),t.value=void 0},onError:(N,C)=>{n.value.transition(d.Disconnect),g.showError("Error occurred while streaming queue messages from channel :"+a.channel)},onMessage:(N,C)=>{const p=JSON.parse(C.data);if(p.isError)switch(t.value=void 0,_.value=0,p.requestType){case"stream_queue_messages":n.value.transition(d.Connect);break;case"ack_queue_messages":n.value.transition(d.TransactionComplete),g.showError("Error: "+p.error);break;case"reject_queue_messages":n.value.isTransactionExpired()||(g.showError("Error: "+p.error),n.value.transition(d.TransactionComplete));break}else switch(p.requestType){case"stream_queue_messages":t.value=p.message,_.value=t.value.sequence,n.value.transition(d.InTransaction),h.value=S.value,setTimeout(()=>{n.value.isInTransaction()&&(n.value.transition(d.TransactionExpired),R())},(S.value+1)*1e3),F();break;case"ack_queue_messages":t.value=null,_.value=0,n.value.transition(d.TransactionComplete),g.showSuccess("Message acknowledged");break;case"reject_queue_messages":t.value=null,_.value=0,n.value.transition(d.TransactionComplete),g.showSuccess("Message rejected");break}I()}}),B=()=>{k.open()},I=()=>{n.value.isConnected()&&(n.value.transition(d.StartTransaction),k.send(JSON.stringify(new ne().setChannel(a.channel).setVisibilitySeconds(S.value).setWaitSeconds(A.value))))},E=()=>{k.close()},J=()=>{w(),k.send(JSON.stringify(new ae(_.value)))},R=()=>{w(),k.send(JSON.stringify(new ie(_.value)))},O=()=>{n.value.transition(d.TransactionComplete),t.value=null,_.value=0,I()};return(N,C)=>{const p=j("InputNumber"),b=j("Tag"),u=H,W=P;return c(),x("div",de,[i("div",ue,[i("div",ve,[i("div",me,[i("div",{class:Q(["col-12 md:col-3 pt-0",s(n).isDisconnected()?"":"div-disabled"])},[pe,r(p,{id:"visibility",modelValue:S.value,"onUpdate:modelValue":C[0]||(C[0]=$=>S.value=$),min:10,max:3600,class:"mt-1"},null,8,["modelValue"])],2),i("div",he,[i("div",null,[s(n).isDisconnected()?(c(),v(s(q),{key:0,label:"Stream",class:"button-queue",icon:"pi pi-play",onClick:B})):l("",!0),s(n).isDisconnected()?l("",!0):(c(),v(s(q),{key:1,label:"Stop",class:"button-queue",icon:"pi pi-stop",onClick:E}))])]),s(n).isInTransaction()?(c(),x("div",_e,[s(n).isInTransaction()?(c(),v(s(q),{key:0,label:"Ack",class:"button-queue",icon:"pi pi-check",onClick:J})):l("",!0)])):l("",!0),s(n).isInTransaction()?(c(),x("div",be,[r(s(q),{label:"Reject",class:"button-queue",icon:"pi pi-times",onClick:R})])):l("",!0),s(n).isTransactionExpired()?(c(),x("div",fe,[r(s(q),{label:"Refresh",class:"button-queue",icon:"pi pi-refresh",onClick:O})])):l("",!0)])]),i("div",Te,[i("div",ye,[s(n).isDisconnected()?(c(),v(b,{key:0,class:"text-sm border-round-xl font-italic font-light mr-1 bg-error"},{default:f(()=>[T("Disconnected")]),_:1})):l("",!0),s(n).isConnected()?(c(),v(b,{key:1,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:f(()=>[T("Connected")]),_:1})):l("",!0),s(n).isStartTransaction()?(c(),v(b,{key:2,class:"text-sm border-round-xl font-italic font-light mr-1 bg-warning"},{default:f(()=>[T("Waiting for a Message")]),_:1})):l("",!0),s(n).isInTransaction()&&h.value>10?(c(),v(b,{key:3,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:f(()=>[T("Transaction is currently visible for "+V(h.value)+" seconds",1)]),_:1})):l("",!0),s(n).isInTransaction()&&h.value<=10?(c(),v(b,{key:4,class:"text-sm border-round-xl font-italic font-light mr-1 bg-orange-500"},{default:f(()=>[T("Transaction visibility will expires in "+V(h.value)+" seconds ",1)]),_:1})):l("",!0),s(n).isEndTransaction()?(c(),v(b,{key:5,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:f(()=>[T("Transaction Completed")]),_:1})):l("",!0),s(n).isTransactionExpired()?(c(),v(b,{key:6,class:"text-sm border-round-xl font-italic font-light mr-1 bg-error"},{default:f(()=>[T("Transaction visibility expired")]),_:1})):l("",!0)])])]),s(t)?(c(),x("div",xe,[i("div",ge,[s(t).messageId!==""?(c(),x("div",Se,[i("div",ke,[r(u,{label:"Message Id",value:s(t).messageId},null,8,["value"])]),i("div",Ce,[r(u,{label:"Timestamp",value:s(t).timestamp},null,8,["value"])]),i("div",qe,[r(u,{label:"Message Sequence",value:s(t).sequence},null,8,["value"])]),i("div",we,[r(u,{label:"Client Id",value:s(t).clientId},null,8,["value"])]),i("div",Ie,[r(u,{label:"Delivered Count",value:s(t).receivedCount},null,8,["value"])]),i("div",De,[r(u,{label:"Re-Routed From",value:s(t).reRoutedFrom},null,8,["value"])]),i("div",Ee,[r(u,{label:"Expiration At",value:s(t).expirationAt},null,8,["value"])]),i("div",Re,[r(u,{label:"Delayed Until",value:s(t).delayedTo},null,8,["value"])]),i("div",Ne,[r(u,{label:"Metadata",value:s(t).metadata},null,8,["value"])]),i("div",Ve,[r(u,{label:"Tags",value:s(t).tags},null,8,["value"])]),i("div",je,[r(W,{label:"Body",value:s(t).body,style:{height:"32vh"}},null,8,["value"])])])):l("",!0)])])):l("",!0)])}}}),He=se(Fe,[["__scopeId","data-v-42a5db7b"]]);export{He as default};
