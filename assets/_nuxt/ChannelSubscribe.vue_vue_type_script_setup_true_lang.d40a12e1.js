import J from"./InputText.a5d51f5e.js";import K from"./InputDropbox.b713c747.js";import Q from"./InputNumber.432bd6c1.js";import X from"./InputCalander.89249c95.js";import{u as Z}from"./useToastMessage.47adc00c.js";import{a as ee,P as te,e as se,s as d,L as le,o as a,f as i,h as o,i as n,q as u,l as I,c as k,u as p,a1 as D,w as m,Q as q,t as b,r as P}from"./entry.7307fc4c.js";import{c as ae,d as oe}from"./stream.cbe555aa.js";import{h as ne}from"./StatStripCard.vue_vue_type_style_index_0_scoped_b87ef05f_lang.ef632115.js";import{_ as de}from"./ReceivedMessage.vue_vue_type_script_setup_true_lang.ccb5e7f5.js";const ie={class:"grid-nogutter grid col-12 p-0"},re={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},ue={class:"flex flex-grow-1 align-items-end p-0"},ce={class:"align-items-end grid p-fluid col-11 pb-0 mb-1"},me={class:"col-12 md:col-2 pt-0"},ve={key:0,class:"col-12 md:col-2"},pe={key:2,class:"col-12 md:col-2 pt-0"},be={key:3,class:"col-12 md:col-2 pt-0"},_e={key:4,class:"col-12 md:col-2 pt-0"},ye={class:"col-12 md:col-2 pt-0"},ge={class:"col-12 md:col-2 pt-0"},he={class:"mb-3"},fe={class:"flex justify-content-end",style:{"min-width":"10rem"}},we={key:0,class:"col-12 md:12 pt-1"},Se={key:0,class:"white-space-nowrap overflow-hidden text-overflow-ellipsis",style:{width:"13em"}},ke={key:1},xe=o("code",{class:"text-grey font-italic"},"N/A",-1),Ve=[xe],Me={key:0,class:"white-space-nowrap overflow-hidden text-overflow-ellipsis",style:{width:"30em"}},Ce={class:"text-overflow-ellipsis"},De={key:1},Pe=o("code",{class:"text-grey font-italic"},"No Body",-1),Ne=[Pe],Ee=ee({__name:"ChannelSubscribe",props:{channel:{type:String,default:()=>""},type:{type:String,default:()=>""}},setup(v){const g=v;te(()=>{r.value=[],C.value=null,l.value&&N()});const U=se(),{ApiBaseHost:$,BaseWebSocket:L}=ae();let r=d([]),f=le({});const l=d(!1),c=d(!1),w=d(""),S=d(""),F=Z(),_=d("none"),x=d(1),V=d(new Date),M=d(5),B=d([{label:"No Replay",value:"none"},{label:"First Message",value:"first"},{label:"Last Message",value:"last"},{label:"Sequence Number",value:"sequence"},{label:"Since Time",value:"time"},{label:"Time Delta",value:"delta"}]),R=()=>{let t=`channel=${g.channel}`;if(g.type==="events")t+="&subscribe_type=events";else{if(t+="&subscribe_type=events_store",S.value===""){const s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);t+=`&client_id=${s}`}else t+=`&client_id=${S.value}`;switch(_.value){case"none":t+="&events_store_type_data=1";break;case"first":t+="&events_store_type_data=2";break;case"last":t+="&events_store_type_data=3";break;case"sequence":t+=`&events_store_type_data=4&events_store_type_value=${x.value}`;break;case"time":t+=`&events_store_type_data=5&events_store_type_value=${V.value.toISOString()}`;break;case"delta":t+=`&events_store_type_data=6&events_store_type_value=${M.value}`;break}}return w.value!==""&&(t+=`&group=${w.value}`),`${L.value}${$.value}/api/subscribe/pubsub?${t}`},E=()=>{f=oe(R(),{autoClose:!1,immediate:!1,onConnected:()=>{l.value=!0,c.value=!1,r.value=[]},onDisconnected:()=>{l.value=!1,c.value=!1},onError:(t,s)=>{l.value=!1,c.value=!1,F.showError("Error occurred while subscribing to channel "+g.type+":"+g.channel)},onMessage:(t,s)=>{l.value=!0,c.value=!1;const h=JSON.parse(s.data);h.index=r.value.length+1,r.value.push(h)}}),c.value=!0,f.open()},N=()=>{c.value=!1,f&&f.close()},O=()=>{r.value=[]},C=d(),Y=t=>{A(t.index)},A=t=>{U.open(de,{props:{header:g.type==="events"?"View PubSub Events Message":"View PubSub Events-Store Message",style:{width:"65vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:r.value[t]}})},H=t=>t===0?"N/A":ne(t).format("YYYY-MM-DD HH:mm:ss");return(t,s)=>{const h=J,G=K,T=Q,W=X,j=P("Tag"),y=P("Column"),z=P("DataTable");return a(),i("div",ie,[o("div",re,[o("div",ue,[o("div",ce,[o("div",me,[n(h,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),label:"Set Group Name",disabled:l.value,placeholder:"No Group"},null,8,["modelValue","disabled"])]),v.type!=="events"?(a(),i("div",ve,[n(h,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=e=>S.value=e),label:"Set Client Id",disabled:l.value,placeholder:"Random Client id"},null,8,["modelValue","disabled"])])):u("",!0),v.type!=="events"?(a(),i("div",{key:1,class:I(["col-12 md:col-2 pt-0",l.value?"div-disabled":""])},[n(G,{label:"Replay From",modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e),options:B.value},null,8,["modelValue","options"])],2)):u("",!0),_.value==="sequence"&&v.type!=="events"?(a(),i("div",pe,[n(T,{modelValue:x.value,"onUpdate:modelValue":s[3]||(s[3]=e=>x.value=e),label:"Set Message Sequence",disabled:l.value,min:1},null,8,["modelValue","disabled"])])):u("",!0),_.value==="time"&&v.type!=="events"?(a(),i("div",be,[n(W,{modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=e=>V.value=e),label:"Time Since",disabled:l.value},null,8,["modelValue","disabled"])])):u("",!0),_.value==="delta"&&v.type!=="events"?(a(),i("div",_e,[n(T,{modelValue:M.value,"onUpdate:modelValue":s[5]||(s[5]=e=>M.value=e),label:"Set Delta Seconds",disabled:l.value},null,8,["modelValue","disabled"])])):u("",!0),o("div",ye,[l.value?u("",!0):(a(),k(p(D),{key:0,label:"Subscribe",class:"button-grey",icon:"pi pi-angle-double-down",onClick:E,disabled:c.value},null,8,["disabled"])),l.value?(a(),k(p(D),{key:1,label:"Unsubscribe",class:"button-grey",icon:"pi pi-angle-double-up",onClick:N,disabled:c.value},null,8,["disabled"])):u("",!0)]),o("div",ge,[l.value?(a(),k(p(D),{key:0,label:"Clear",class:"button-grey",icon:"pi pi-trash",onClick:O,disabled:p(r).length===0},null,8,["disabled"])):u("",!0)])])]),o("div",he,[o("div",fe,[n(j,{class:I(["text-sm border-round-xl font-italic font-light mr-1",l.value?"bg-success":"bg-error"])},{default:m(()=>[q(b(l.value?"Subscribed":"Unsubscribed"),1)]),_:1},8,["class"])])])]),p(r).length>0?(a(),i("div",we,[n(z,{value:p(r),paginator:p(r).length>25,rows:25,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[25,50,100],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Messages",responsiveLayout:"scroll",class:"p-datatable-sm",dataKey:"messageId",onRowSelect:Y,selection:C.value,"onUpdate:selection":s[6]||(s[6]=e=>C.value=e),selectionMode:"single"},{default:m(()=>[n(y,{header:"#",headerStyle:"width: 1rem"},{body:m(({index:e})=>[q(b(e+1),1)]),_:1}),v.type!=="events"?(a(),k(y,{key:0,header:"Sequence",field:"sequence",sortable:"",headerStyle:"width:4em"},{body:m(({data:e})=>[o("div",null,b(e.sequence),1)]),_:1})):u("",!0),n(y,{header:"Timestamp",sortable:"",headerStyle:"width:8em"},{body:m(({data:e})=>[o("div",null,b(H(e.timestamp)),1)]),_:1}),n(y,{header:"Message Id",field:"messageId",sortable:"",headerStyle:"width:15em"},{body:m(({data:e})=>[o("div",null,b(e.messageId),1)]),_:1}),n(y,{header:"Metadata",field:"metadata",headerStyle:"width:13em"},{body:m(({data:e})=>[e.metadata?(a(),i("div",Se,[o("code",null,b(e.metadata),1)])):(a(),i("div",ke,Ve))]),_:1}),n(y,{header:"Body",field:"body",headerStyle:"width:30em"},{body:m(({data:e})=>[e.body?(a(),i("div",Me,[o("code",Ce,b(e.body),1)])):(a(),i("div",De,Ne))]),_:1})]),_:1},8,["value","paginator","selection"])])):u("",!0)])}}});export{Ee as _};
