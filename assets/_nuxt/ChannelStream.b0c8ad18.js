var z=Object.defineProperty;var H=(e,a,t)=>a in e?z(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var o=(e,a,t)=>(H(e,typeof a!="symbol"?a+"":a,t),t);import{_ as P}from"./Field.vue_vue_type_script_setup_true_lang.b171eb6f.js";import{_ as G}from"./DataField.vue_vue_type_script_setup_true_lang.7f783943.js";import{c as K,f as L,d as X}from"./stream.7512440b.js";import{u as Y}from"./useToastMessage.d880f1b4.js";import{a as Z,s as y,e as M,Q,o as c,f as x,h as i,l as ee,u as s,i as r,c as v,a2 as q,q as l,w as f,R as T,t as V,r as j,p as te,j as se,k as ne}from"./entry.e4fef673.js";import"./StatStripCard.vue_vue_type_style_index_0_scoped_b87ef05f_lang.90af4798.js";class ae{constructor(){o(this,"requestType");o(this,"channel");o(this,"visibilitySeconds");o(this,"waitSeconds");o(this,"refSequence");this.requestType="stream_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=0}setChannel(a){return this.channel=a,this}setVisibilitySeconds(a){return this.visibilitySeconds=a,this}setWaitSeconds(a){return this.waitSeconds=a,this}}class ie{constructor(a){o(this,"requestType");o(this,"channel");o(this,"visibilitySeconds");o(this,"waitSeconds");o(this,"refSequence");this.requestType="ack_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=a}}class oe{constructor(a){o(this,"requestType");o(this,"channel");o(this,"visibilitySeconds");o(this,"waitSeconds");o(this,"refSequence");this.requestType="reject_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=a}}var D=(e=>(e[e.Disconnected=0]="Disconnected",e[e.Connected=1]="Connected",e[e.StartTransaction=2]="StartTransaction",e[e.InTransaction=3]="InTransaction",e[e.EndTransaction=4]="EndTransaction",e[e.TransactionExpired=5]="TransactionExpired",e))(D||{}),d=(e=>(e[e.Connect=0]="Connect",e[e.Disconnect=1]="Disconnect",e[e.StartTransaction=2]="StartTransaction",e[e.InTransaction=3]="InTransaction",e[e.TransactionComplete=4]="TransactionComplete",e[e.TransactionExpired=5]="TransactionExpired",e))(d||{});const ce=[{state:0,event:0,nextState:1},{state:0,event:1,nextState:0},{state:1,event:2,nextState:2},{state:2,event:3,nextState:3},{state:3,event:4,nextState:1},{state:3,event:5,nextState:5},{state:5,event:4,nextState:1},{state:5,event:1,nextState:0},{state:1,event:1,nextState:0},{state:2,event:1,nextState:0},{state:3,event:1,nextState:0},{state:2,event:0,nextState:1}];class le{constructor(a,t,m){o(this,"state");o(this,"event");o(this,"nextState");this.state=a,this.event=t,this.nextState=m}transition(a){const t=ce.find(m=>m.state===this.state&&m.event===a);return t&&(this.state=t.nextState),this.state}isConnected(){return this.state===1}isDisconnected(){return this.state===0}isInTransaction(){return this.state===3}isStartTransaction(){return this.state===2}isEndTransaction(){return this.state===4}isTransactionExpired(){return this.state===5}isTransaction(){return this.isStartTransaction()||this.isInTransaction()||this.isEndTransaction()}}class re{static create(a,t,m){return new le(a,t,m)}}const de=e=>(te("data-v-50d256e3"),e=e(),se(),e),ue={class:"grid-nogutter grid col-12 p-0"},ve={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},me={class:"flex flex-grow-1 align-items-end p-0"},pe={class:"align-items-end grid p-fluid col-7 pb-0 mb-1"},he=de(()=>i("label",{class:"text-sm ml-1 font-medium",for:"messages"},"Visibility in Seconds",-1)),_e={class:"col-12 md:col-3 pt-0"},be={key:0,class:"col-12 md:col-3 pt-0"},fe={key:1,class:"col-12 md:col-3 pt-0"},Te={key:2,class:"col-12 md:col-3 pt-0"},ye={class:"mb-2",style:{"min-width":"15rem"}},xe={class:"flex justify-content-end"},ge={key:0,class:"col-12 md:12 pt-3"},Se={class:"pt-0 pl-1 pr-1 pb-3"},ke={key:0,class:"grid formgrid p-fluid mt-3"},Ce={class:"col-12 md:col-3 p-1"},qe={class:"col-12 md:col-3 p-1"},we={class:"col-12 md:col-3 p-1"},Ie={class:"col-12 md:col-3 p-1"},De={class:"col-12 md:col-3 p-1"},Ee={class:"col-12 md:col-3 p-1"},Re={class:"col-12 md:col-3 p-1"},Ne={class:"col-12 md:col-3 p-1"},Ve={class:"col-12 md:col-6 p-1"},je={class:"col-12 md:col-6 p-1"},Fe={class:"col-12 md:col-12 p-1"},Ae=Z({__name:"ChannelStream",props:{channel:{type:String,default:()=>""}},setup(e){const a=e;let t=y(void 0);const{ApiBaseHost:m,BaseWebSocket:F}=K();M();const h=y(0),{pause:w,resume:A,isActive:Be}=L(()=>{h.value>0?h.value--:w()},1e3);let n=y(re.create(D.Disconnected,d.Connect,D.Connected));Q(()=>{E()});const g=Y(),S=y(60),B=y(3600),_=y(0),k=X(`${F.value}${m.value}/api/stream_queue_messages`,{autoClose:!1,immediate:!1,onConnected:()=>{n.value.transition(d.Connect),I()},onDisconnected:()=>{n.value.transition(d.Disconnect),t.value=void 0},onError:(N,C)=>{n.value.transition(d.Disconnect),g.showError("Error occurred while streaming queue messages from channel :"+a.channel)},onMessage:(N,C)=>{const p=JSON.parse(C.data);if(p.isError)switch(t.value=void 0,_.value=0,p.requestType){case"stream_queue_messages":n.value.transition(d.Connect);break;case"ack_queue_messages":n.value.transition(d.TransactionComplete),g.showError("Error: "+p.error);break;case"reject_queue_messages":n.value.isTransactionExpired()||(g.showError("Error: "+p.error),n.value.transition(d.TransactionComplete));break}else switch(p.requestType){case"stream_queue_messages":t.value=p.message,_.value=t.value.sequence,n.value.transition(d.InTransaction),h.value=S.value,setTimeout(()=>{n.value.isInTransaction()&&(n.value.transition(d.TransactionExpired),R())},(S.value+1)*1e3),A();break;case"ack_queue_messages":t.value=null,_.value=0,n.value.transition(d.TransactionComplete),g.showSuccess("Message acknowledged");break;case"reject_queue_messages":t.value=null,_.value=0,n.value.transition(d.TransactionComplete),g.showSuccess("Message rejected");break}I()}}),W=()=>{k.open()},I=()=>{n.value.isConnected()&&(n.value.transition(d.StartTransaction),k.send(JSON.stringify(new ae().setChannel(a.channel).setVisibilitySeconds(S.value).setWaitSeconds(B.value))))},E=()=>{k.close()},J=()=>{w(),k.send(JSON.stringify(new ie(_.value)))},R=()=>{w(),k.send(JSON.stringify(new oe(_.value)))},O=()=>{n.value.transition(d.TransactionComplete),t.value=null,_.value=0,I()};return(N,C)=>{const p=j("InputNumber"),b=j("Tag"),u=P,$=G;return c(),x("div",ue,[i("div",ve,[i("div",me,[i("div",pe,[i("div",{class:ee(["col-12 md:col-3 pt-0",s(n).isDisconnected()?"":"div-disabled"])},[he,r(p,{id:"visibility",modelValue:S.value,"onUpdate:modelValue":C[0]||(C[0]=U=>S.value=U),min:10,max:3600,class:"mt-1"},null,8,["modelValue"])],2),i("div",_e,[i("div",null,[s(n).isDisconnected()?(c(),v(s(q),{key:0,label:"Stream",class:"button-queue",icon:"pi pi-play",onClick:W})):l("",!0),s(n).isDisconnected()?l("",!0):(c(),v(s(q),{key:1,label:"Stop",class:"button-queue",icon:"pi pi-stop",onClick:E}))])]),s(n).isInTransaction()?(c(),x("div",be,[s(n).isInTransaction()?(c(),v(s(q),{key:0,label:"Ack",class:"button-queue",icon:"pi pi-check",onClick:J})):l("",!0)])):l("",!0),s(n).isInTransaction()?(c(),x("div",fe,[r(s(q),{label:"Reject",class:"button-queue",icon:"pi pi-times",onClick:R})])):l("",!0),s(n).isTransactionExpired()?(c(),x("div",Te,[r(s(q),{label:"Refresh",class:"button-queue",icon:"pi pi-refresh",onClick:O})])):l("",!0)])]),i("div",ye,[i("div",xe,[s(n).isDisconnected()?(c(),v(b,{key:0,class:"text-sm border-round-xl font-italic font-light mr-1 bg-error"},{default:f(()=>[T("Disconnected")]),_:1})):l("",!0),s(n).isConnected()?(c(),v(b,{key:1,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:f(()=>[T("Connected")]),_:1})):l("",!0),s(n).isStartTransaction()?(c(),v(b,{key:2,class:"text-sm border-round-xl font-italic font-light mr-1 bg-warning"},{default:f(()=>[T("Waiting for a Message")]),_:1})):l("",!0),s(n).isInTransaction()&&h.value>10?(c(),v(b,{key:3,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:f(()=>[T("Transaction is currently visible for "+V(h.value)+" seconds",1)]),_:1})):l("",!0),s(n).isInTransaction()&&h.value<=10?(c(),v(b,{key:4,class:"text-sm border-round-xl font-italic font-light mr-1 bg-orange-500"},{default:f(()=>[T("Transaction visibility will expires in "+V(h.value)+" seconds ",1)]),_:1})):l("",!0),s(n).isEndTransaction()?(c(),v(b,{key:5,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:f(()=>[T("Transaction Completed")]),_:1})):l("",!0),s(n).isTransactionExpired()?(c(),v(b,{key:6,class:"text-sm border-round-xl font-italic font-light mr-1 bg-error"},{default:f(()=>[T("Transaction visibility expired")]),_:1})):l("",!0)])])]),s(t)?(c(),x("div",ge,[i("div",Se,[s(t).messageId!==""?(c(),x("div",ke,[i("div",Ce,[r(u,{label:"Message Id",value:s(t).messageId},null,8,["value"])]),i("div",qe,[r(u,{label:"Timestamp",value:s(t).timestamp},null,8,["value"])]),i("div",we,[r(u,{label:"Message Sequence",value:s(t).sequence},null,8,["value"])]),i("div",Ie,[r(u,{label:"Client Id",value:s(t).clientId},null,8,["value"])]),i("div",De,[r(u,{label:"Delivered Count",value:s(t).receivedCount},null,8,["value"])]),i("div",Ee,[r(u,{label:"Re-Routed From",value:s(t).reRoutedFrom},null,8,["value"])]),i("div",Re,[r(u,{label:"Expiration At",value:s(t).expirationAt},null,8,["value"])]),i("div",Ne,[r(u,{label:"Delayed Until",value:s(t).delayedTo},null,8,["value"])]),i("div",Ve,[r(u,{label:"Metadata",value:s(t).metadata},null,8,["value"])]),i("div",je,[r(u,{label:"Tags",value:s(t).tags},null,8,["value"])]),i("div",Fe,[r($,{label:"Body",value:s(t).body,style:{height:"32vh"}},null,8,["value"])])])):l("",!0)])])):l("",!0)])}}}),Pe=ne(Ae,[["__scopeId","data-v-50d256e3"]]);export{Pe as default};
