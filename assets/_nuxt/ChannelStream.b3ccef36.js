import{_ as $}from"./Field.vue_vue_type_script_setup_true_lang.f900a510.js";import{_ as U}from"./DataField.vue_vue_type_script_setup_true_lang.d20fb5f6.js";import{a as z,v as T,J as H,f as K,a5 as P,I as G,K as L,o,h as x,i as a,m as M,u as t,j as l,c as u,a4 as S,s as c,w as b,r as R,M as f,t as N,p as X,k as Y,l as Z}from"./entry.c95b333b.js";import{u as Q}from"./useToastMessage.5bad6c4f.js";class ee{setChannel(i){return this.channel=i,this}setVisibilitySeconds(i){return this.visibilitySeconds=i,this}setWaitSeconds(i){return this.waitSeconds=i,this}constructor(){this.requestType="stream_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=0}}class te{constructor(i){this.requestType="ack_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=i}}class se{constructor(i){this.requestType="reject_queue_messages",this.channel="",this.visibilitySeconds=0,this.waitSeconds=0,this.refSequence=i}}var w=(e=>(e[e.Disconnected=0]="Disconnected",e[e.Connected=1]="Connected",e[e.StartTransaction=2]="StartTransaction",e[e.InTransaction=3]="InTransaction",e[e.EndTransaction=4]="EndTransaction",e[e.TransactionExpired=5]="TransactionExpired",e))(w||{}),r=(e=>(e[e.Connect=0]="Connect",e[e.Disconnect=1]="Disconnect",e[e.StartTransaction=2]="StartTransaction",e[e.InTransaction=3]="InTransaction",e[e.TransactionComplete=4]="TransactionComplete",e[e.TransactionExpired=5]="TransactionExpired",e))(r||{});const ne=[{state:0,event:0,nextState:1},{state:0,event:1,nextState:0},{state:1,event:2,nextState:2},{state:2,event:3,nextState:3},{state:3,event:4,nextState:1},{state:3,event:5,nextState:5},{state:5,event:4,nextState:1},{state:5,event:1,nextState:0},{state:1,event:1,nextState:0},{state:2,event:1,nextState:0},{state:3,event:1,nextState:0},{state:2,event:0,nextState:1}];class ae{constructor(i,n,v){this.state=i,this.event=n,this.nextState=v}transition(i){const n=ne.find(v=>v.state===this.state&&v.event===i);return n&&(this.state=n.nextState),this.state}isConnected(){return this.state===1}isDisconnected(){return this.state===0}isInTransaction(){return this.state===3}isStartTransaction(){return this.state===2}isEndTransaction(){return this.state===4}isTransactionExpired(){return this.state===5}isTransaction(){return this.isStartTransaction()||this.isInTransaction()||this.isEndTransaction()}}class ie{static create(i,n,v){return new ae(i,n,v)}}const oe=e=>(X("data-v-cc4a0174"),e=e(),Y(),e),ce={class:"grid-nogutter grid col-12 p-0"},le={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},re={class:"flex flex-grow-1 align-items-end p-0"},de={class:"align-items-end grid p-fluid col-7 pb-0 mb-1"},ue=oe(()=>a("label",{class:"text-sm ml-1 font-medium",for:"messages"},"Visibility in Seconds",-1)),ve={class:"col-12 md:col-3 pt-0"},_e={key:0,class:"col-12 md:col-3 pt-0"},me={key:1,class:"col-12 md:col-3 pt-0"},he={key:2,class:"col-12 md:col-3 pt-0"},pe={class:"mb-2",style:{"min-width":"15rem"}},be={class:"flex justify-content-end"},fe=f("Disconnected"),Te=f("Connected"),xe=f("Waiting for a Message"),ge=f("Transaction Completed"),ye=f("Transaction visibility expired"),ke={key:0,class:"col-12 md:12 pt-3"},Ce={class:"pt-0 pl-1 pr-1 pb-3"},Se={key:0,class:"grid formgrid p-fluid mt-3"},qe={class:"col-12 md:col-3 p-1"},we={class:"col-12 md:col-3 p-1"},Ie={class:"col-12 md:col-3 p-1"},De={class:"col-12 md:col-3 p-1"},Ee={class:"col-12 md:col-3 p-1"},Re={class:"col-12 md:col-3 p-1"},Ne={class:"col-12 md:col-3 p-1"},Ve={class:"col-12 md:col-3 p-1"},je={class:"col-12 md:col-6 p-1"},Fe={class:"col-12 md:col-6 p-1"},Ae={class:"col-12 md:col-12 p-1"},Be=z({__name:"ChannelStream",props:{channel:{type:String,default:()=>""}},setup(e){const i=e;let n=T(void 0);const{ApiBaseHost:v}=H();K();const m=T(0),{pause:V,resume:j,isActive:Je}=P(()=>{m.value>0?m.value--:V()},1e3);let s=T(ie.create(w.Disconnected,r.Connect,w.Connected));G(()=>{I()});const g=Q(),y=T(60),F=T(3600),h=T(0),k=L(`ws://${v.value}/api/stream_queue_messages`,{autoClose:!1,immediate:!1,onConnected:()=>{s.value.transition(r.Connect),q()},onDisconnected:()=>{s.value.transition(r.Disconnect),n.value=void 0},onError:(E,C)=>{s.value.transition(r.Disconnect),g.showError("Error occurred while streaming queue messages from channel :"+i.channel)},onMessage:(E,C)=>{const _=JSON.parse(C.data);if(_.isError)switch(n.value=void 0,h.value=0,_.requestType){case"stream_queue_messages":s.value.transition(r.Connect);break;case"ack_queue_messages":s.value.transition(r.TransactionComplete),g.showError("Error: "+_.error);break;case"reject_queue_messages":s.value.isTransactionExpired()||(g.showError("Error: "+_.error),s.value.transition(r.TransactionComplete));break}else switch(_.requestType){case"stream_queue_messages":n.value=_.message,h.value=n.value.sequence,s.value.transition(r.InTransaction),m.value=y.value,setTimeout(()=>{s.value.isInTransaction()&&(s.value.transition(r.TransactionExpired),D())},(y.value+1)*1e3),j();break;case"ack_queue_messages":n.value=null,h.value=0,s.value.transition(r.TransactionComplete),g.showSuccess("Message acknowledged");break;case"reject_queue_messages":n.value=null,h.value=0,s.value.transition(r.TransactionComplete),g.showSuccess("Message rejected");break}q()}}),A=()=>{k.open()},q=()=>{s.value.isConnected()&&(s.value.transition(r.StartTransaction),k.send(JSON.stringify(new ee().setChannel(i.channel).setVisibilitySeconds(y.value).setWaitSeconds(F.value))))},I=()=>{k.close()},B=()=>{k.send(JSON.stringify(new te(h.value)))},D=()=>{k.send(JSON.stringify(new se(h.value)))},J=()=>{s.value.transition(r.TransactionComplete),n.value=null,h.value=0,q()};return(E,C)=>{const _=R("InputNumber"),p=R("Tag"),d=$,O=U;return o(),x("div",ce,[a("div",le,[a("div",re,[a("div",de,[a("div",{class:M(["col-12 md:col-3 pt-0",t(s).isDisconnected()?"":"div-disabled"])},[ue,l(_,{id:"visibility",modelValue:y.value,"onUpdate:modelValue":C[0]||(C[0]=W=>y.value=W),min:10,max:3600,class:"mt-1"},null,8,["modelValue"])],2),a("div",ve,[a("div",null,[t(s).isDisconnected()?(o(),u(t(S),{key:0,label:"Stream",class:"button-queue",icon:"pi pi-play",onClick:A})):c("",!0),t(s).isDisconnected()?c("",!0):(o(),u(t(S),{key:1,label:"Stop",class:"button-queue",icon:"pi pi-stop",onClick:I}))])]),t(s).isInTransaction()?(o(),x("div",_e,[t(s).isInTransaction()?(o(),u(t(S),{key:0,label:"Ack",class:"button-queue",icon:"pi pi-check",onClick:B})):c("",!0)])):c("",!0),t(s).isInTransaction()?(o(),x("div",me,[l(t(S),{label:"Reject",class:"button-queue",icon:"pi pi-times",onClick:D})])):c("",!0),t(s).isTransactionExpired()?(o(),x("div",he,[l(t(S),{label:"Refresh",class:"button-queue",icon:"pi pi-refresh",onClick:J})])):c("",!0)])]),a("div",pe,[a("div",be,[t(s).isDisconnected()?(o(),u(p,{key:0,class:"text-sm border-round-xl font-italic font-light mr-1 bg-error"},{default:b(()=>[fe]),_:1})):c("",!0),t(s).isConnected()?(o(),u(p,{key:1,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:b(()=>[Te]),_:1})):c("",!0),t(s).isStartTransaction()?(o(),u(p,{key:2,class:"text-sm border-round-xl font-italic font-light mr-1 bg-warning"},{default:b(()=>[xe]),_:1})):c("",!0),t(s).isInTransaction()&&m.value>10?(o(),u(p,{key:3,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:b(()=>[f("Transaction is currently visible for "+N(m.value)+" seconds",1)]),_:1})):c("",!0),t(s).isInTransaction()&&m.value<=10?(o(),u(p,{key:4,class:"text-sm border-round-xl font-italic font-light mr-1 bg-orange-500"},{default:b(()=>[f("Transaction visibility will expires in "+N(m.value)+" seconds ",1)]),_:1})):c("",!0),t(s).isEndTransaction()?(o(),u(p,{key:5,class:"text-sm border-round-xl font-italic font-light mr-1 bg-success"},{default:b(()=>[ge]),_:1})):c("",!0),t(s).isTransactionExpired()?(o(),u(p,{key:6,class:"text-sm border-round-xl font-italic font-light mr-1 bg-error"},{default:b(()=>[ye]),_:1})):c("",!0)])])]),t(n)?(o(),x("div",ke,[a("div",Ce,[t(n).messageId!==""?(o(),x("div",Se,[a("div",qe,[l(d,{label:"Message Id",value:t(n).messageId},null,8,["value"])]),a("div",we,[l(d,{label:"Timestamp",value:t(n).timestamp},null,8,["value"])]),a("div",Ie,[l(d,{label:"Message Sequence",value:t(n).sequence},null,8,["value"])]),a("div",De,[l(d,{label:"Client Id",value:t(n).clientId},null,8,["value"])]),a("div",Ee,[l(d,{label:"Delivered Count",value:t(n).receivedCount},null,8,["value"])]),a("div",Re,[l(d,{label:"Re-Routed From",value:t(n).reRoutedFrom},null,8,["value"])]),a("div",Ne,[l(d,{label:"Expiration At",value:t(n).expirationAt},null,8,["value"])]),a("div",Ve,[l(d,{label:"Delayed Until",value:t(n).delayedTo},null,8,["value"])]),a("div",je,[l(d,{label:"Metadata",value:t(n).metadata},null,8,["value"])]),a("div",Fe,[l(d,{label:"Tags",value:t(n).tags},null,8,["value"])]),a("div",Ae,[l(O,{label:"Body",value:t(n).body,style:{height:"32vh"}},null,8,["value"])])])):c("",!0)])])):c("",!0)])}}}),ze=Z(Be,[["__scopeId","data-v-cc4a0174"]]);export{ze as default};
