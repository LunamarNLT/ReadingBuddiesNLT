import J from"./InputText.0abbd94c.js";import K from"./InputDropbox.0d032b1d.js";import W from"./InputNumber.0c5624bb.js";import Q from"./InputCalander.67ee7b75.js";import{u as X}from"./useToastMessage.bad030a2.js";import{a as Z,I as ee,f as te,J as se,v as d,z as le,o as a,h as i,i as o,j as n,s as u,m as T,c as k,u as p,a5 as D,w as m,K as ae,r as I,M as U,t as v,G as oe}from"./entry.86b9e19f.js";import{_ as ne}from"./ReceivedMessage.vue_vue_type_script_setup_true_lang.bae92a37.js";const de={class:"grid-nogutter grid col-12 p-0"},ie={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},re={class:"flex flex-grow-1 align-items-end p-0"},ue={class:"align-items-end grid p-fluid col-11 pb-0 mb-1"},ce={class:"col-12 md:col-2 pt-0"},me={key:0,class:"col-12 md:col-2"},pe={key:2,class:"col-12 md:col-2 pt-0"},ve={key:3,class:"col-12 md:col-2 pt-0"},be={key:4,class:"col-12 md:col-2 pt-0"},_e={class:"col-12 md:col-2 pt-0"},ge={class:"col-12 md:col-2 pt-0"},ye={class:"mb-3"},he={class:"flex justify-content-end",style:{"min-width":"10rem"}},fe={key:0,class:"col-12 md:12 pt-1"},we={key:0,class:"white-space-nowrap overflow-hidden text-overflow-ellipsis",style:{width:"13em"}},Se={key:1},ke=o("code",{class:"text-grey font-italic"},"N/A",-1),xe=[ke],Ve={key:0,class:"white-space-nowrap overflow-hidden text-overflow-ellipsis",style:{width:"30em"}},Me={class:"text-overflow-ellipsis"},Ce={key:1},De=o("code",{class:"text-grey font-italic"},"No Body",-1),Ie=[De],Le=Z({__name:"ChannelSubscribe",props:{channel:{type:String,default:()=>""},type:{type:String,default:()=>""}},setup(h){const g=h;ee(()=>{r.value=[],C.value=null,l.value&&N()});const q=te(),{ApiBaseHost:$}=se();let r=d([]),f=le({});const l=d(!1),c=d(!1),w=d(""),S=d(""),F=X(),b=d("none"),x=d(1),V=d(new Date),M=d(5),L=d([{label:"No Replay",value:"none"},{label:"First Message",value:"first"},{label:"Last Message",value:"last"},{label:"Sequence Number",value:"sequence"},{label:"Since Time",value:"time"},{label:"Time Delta",value:"delta"}]),R=()=>{let t=`channel=${g.channel}`;if(g.type==="events")t+="&subscribe_type=events";else switch(t+="&subscribe_type=events_store",S.value===""?t+=`&client_id=${Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}`:t+=`&client_id=${S.value}`,b.value){case"none":t+="&events_store_type_data=1";break;case"first":t+="&events_store_type_data=2";break;case"last":t+="&events_store_type_data=3";break;case"sequence":t+=`&events_store_type_data=4&events_store_type_value=${x.value}`;break;case"time":t+=`&events_store_type_data=5&events_store_type_value=${V.value.toISOString()}`;break;case"delta":t+=`&events_store_type_data=6&events_store_type_value=${M.value}`;break}return w.value!==""&&(t+=`&group=${w.value}`),`ws://${$.value}/api/subscribe/pubsub?${t}`},B=()=>{f=ae(R(),{autoClose:!1,immediate:!1,onConnected:()=>{l.value=!0,c.value=!1,r.value=[]},onDisconnected:()=>{l.value=!1,c.value=!1},onError:(t,s)=>{l.value=!1,c.value=!1,F.showError("Error occurred while subscribing to channel "+g.type+":"+g.channel)},onMessage:(t,s)=>{l.value=!0,c.value=!1;const y=JSON.parse(s.data);y.index=r.value.length+1,r.value.push(y)}}),c.value=!0,f.open()},N=()=>{c.value=!1,f&&f.close()},E=()=>{r.value=[]},C=d(),O=t=>{Y(t.index)},Y=t=>{q.open(ne,{props:{header:g.type==="events"?"View PubSub Events Message":"View PubSub Events-Store Message",style:{width:"65vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:r.value[t]}})},A=t=>t===0?"N/A":oe(t).format("YYYY-MM-DD HH:mm:ss");return(t,s)=>{const y=J,G=K,P=W,H=Q,j=I("Tag"),_=I("Column"),z=I("DataTable");return a(),i("div",de,[o("div",ie,[o("div",re,[o("div",ue,[o("div",ce,[n(y,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),label:"Set Group Name",disabled:l.value,placeholder:"No Group"},null,8,["modelValue","disabled"])]),h.type!=="events"?(a(),i("div",me,[n(y,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=e=>S.value=e),label:"Set Client Id",disabled:l.value,placeholder:"Random Client id"},null,8,["modelValue","disabled"])])):u("",!0),h.type!=="events"?(a(),i("div",{key:1,class:T(["col-12 md:col-2 pt-0",l.value?"div-disabled":""])},[n(G,{label:"Replay From",modelValue:b.value,"onUpdate:modelValue":s[2]||(s[2]=e=>b.value=e),options:L.value},null,8,["modelValue","options"])],2)):u("",!0),b.value==="sequence"?(a(),i("div",pe,[n(P,{modelValue:x.value,"onUpdate:modelValue":s[3]||(s[3]=e=>x.value=e),label:"Set Message Sequence",disabled:l.value,min:1},null,8,["modelValue","disabled"])])):u("",!0),b.value==="time"?(a(),i("div",ve,[n(H,{modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=e=>V.value=e),label:"Time Since",disabled:l.value},null,8,["modelValue","disabled"])])):u("",!0),b.value==="delta"?(a(),i("div",be,[n(P,{modelValue:M.value,"onUpdate:modelValue":s[5]||(s[5]=e=>M.value=e),label:"Set Delta Seconds",disabled:l.value},null,8,["modelValue","disabled"])])):u("",!0),o("div",_e,[l.value?u("",!0):(a(),k(p(D),{key:0,label:"Subscribe",class:"button-grey",icon:"pi pi-angle-double-down",onClick:B,disabled:c.value},null,8,["disabled"])),l.value?(a(),k(p(D),{key:1,label:"Unsubscribe",class:"button-grey",icon:"pi pi-angle-double-up",onClick:N,disabled:c.value},null,8,["disabled"])):u("",!0)]),o("div",ge,[l.value?(a(),k(p(D),{key:0,label:"Clear",class:"button-grey",icon:"pi pi-trash",onClick:E,disabled:p(r).length===0},null,8,["disabled"])):u("",!0)])])]),o("div",ye,[o("div",he,[n(j,{class:T(["text-sm border-round-xl font-italic font-light mr-1",l.value?"bg-success":"bg-error"])},{default:m(()=>[U(v(l.value?"Subscribed":"Unsubscribed"),1)]),_:1},8,["class"])])])]),p(r).length>0?(a(),i("div",fe,[n(z,{value:p(r),paginator:p(r).length>25,rows:25,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[25,50,100],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Messages",responsiveLayout:"scroll",class:"p-datatable-sm",dataKey:"messageId",onRowSelect:O,selection:C.value,"onUpdate:selection":s[6]||(s[6]=e=>C.value=e),selectionMode:"single"},{default:m(()=>[n(_,{header:"#",headerStyle:"width: 1rem"},{body:m(({index:e})=>[U(v(e+1),1)]),_:1}),h.type!=="events"?(a(),k(_,{key:0,header:"Sequence",field:"sequence",sortable:"",headerStyle:"width:4em"},{body:m(({data:e})=>[o("div",null,v(e.sequence),1)]),_:1})):u("",!0),n(_,{header:"Timestamp",sortable:"",headerStyle:"width:8em"},{body:m(({data:e})=>[o("div",null,v(A(e.timestamp)),1)]),_:1}),n(_,{header:"Message Id",field:"messageId",sortable:"",headerStyle:"width:15em"},{body:m(({data:e})=>[o("div",null,v(e.messageId),1)]),_:1}),n(_,{header:"Metadata",field:"metadata",headerStyle:"width:13em"},{body:m(({data:e})=>[e.metadata?(a(),i("div",we,[o("code",null,v(e.metadata),1)])):(a(),i("div",Se,xe))]),_:1}),n(_,{header:"Body",field:"body",headerStyle:"width:30em"},{body:m(({data:e})=>[e.body?(a(),i("div",Ve,[o("code",Me,v(e.body),1)])):(a(),i("div",Ce,Ie))]),_:1})]),_:1},8,["value","paginator","selection"])])):u("",!0)])}}});export{Le as _};
