import V from"./InputText.63c92f00.js";import{_ as $}from"./Field.vue_vue_type_script_setup_true_lang.8447d9ba.js";import{_ as F}from"./DataField.vue_vue_type_script_setup_true_lang.e7665b77.js";import{u as U}from"./useToastMessage.5053bbd0.js";import{a as E,Q as I,e as Y,s as b,M as H,o as n,f,h as s,i,c as _,q as c,u as t,w as Q,R as A,t as G,l as j,r as y}from"./entry.53b34a98.js";import{c as z,d as J}from"./stream.38699bf4.js";import{m as L}from"./StatStripCard.vue_vue_type_style_index_0_scoped_b87ef05f_lang.52c9345e.js";import O from"./ReplyCommandMessage.87bc4fbe.js";import P from"./ReplyQueryMessage.1258562f.js";const W={class:"grid-nogutter grid col-12 p-0"},K={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},X={class:"flex flex-grow-1 align-items-end p-0"},Z={class:"align-items-end grid p-fluid col-11 pb-0 mb-1"},ee={class:"col-12 md:col-2 pt-0"},se={class:"col-12 md:col-2 pt-0"},oe={class:"col-12 md:col-2 pt-0"},le={class:"col-12 md:col-2 pt-0"},te={class:"mb-3"},ae={class:"flex justify-content-end",style:{"min-width":"10rem"}},ne={key:0,class:"col-12 md:12 pt-3"},ie={class:"pt-0 pl-1 pr-1 pb-3 mt-2"},ce={key:0,class:"grid formgrid p-fluid mt-3"},de={class:"grid formgrid p-fluid col-12 md:col-12 p-1"},re={class:"col-12 md:col-6"},ue={class:"col-12 md:col-6"},pe={class:"col-12 md:col-6 p-1"},me={class:"col-12 md:col-6 p-1"},ve={class:"col-12 md:col-12 p-1"},xe=E({__name:"ChannelSubscribe",props:{channel:{type:String,default:()=>""},type:{type:String,default:()=>""}},setup(w){const r=w;I(()=>{e.value=void 0,o.value&&h()});const g=Y(),{ApiBaseHost:k}=z();let e=b(void 0),u=H({});const o=b(!1),a=b(!1),p=b(""),C=U(),x=()=>{let l=`channel=${r.channel}`;return r.type==="commands"?l+="&subscribe_type=commands":l+="&subscribe_type=queries",p.value!==""&&(l+=`&group=${p.value}`),`ws://${k.value}/api/subscribe/cqrs?${l}`},S=()=>{u=J(x(),{autoClose:!1,immediate:!1,onConnected:()=>{o.value=!0,a.value=!1,e.value=void 0},onDisconnected:()=>{o.value=!1,a.value=!1},onError:(l,d)=>{o.value=!1,a.value=!1,C.showError("Error occurred while subscribing to channel "+r.type+":"+r.channel)},onMessage:(l,d)=>{o.value=!0,a.value=!1,e.value=JSON.parse(d.data)}}),a.value=!0,u.open()},h=()=>{a.value=!1,u&&u.close()},M=()=>{e.value=void 0},q=()=>{e.value.isCommand?g.open(O,{props:{header:"Reply Command",style:{width:"30vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:e.value},onClose:()=>{e.value=void 0}}):g.open(P,{props:{header:"Reply Query",style:{width:"50vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:e.value},onClose:()=>{e.value=void 0}})},N=l=>l===0?"N/A":L(l).format("YYYY-MM-DD HH:mm:ss");return(l,d)=>{const B=V,m=y("Button"),D=y("Tag"),v=$,R=F;return n(),f("div",W,[s("div",K,[s("div",X,[s("div",Z,[s("div",ee,[i(B,{modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=T=>p.value=T),label:"Set Group Name",disabled:o.value,placeholder:"No Group"},null,8,["modelValue","disabled"])]),s("div",se,[o.value?c("",!0):(n(),_(m,{key:0,label:"Subscribe",class:"button-grey",icon:"pi pi-angle-double-down",onClick:S,disabled:a.value},null,8,["disabled"])),o.value?(n(),_(m,{key:1,label:"Unsubscribe",class:"button-grey",icon:"pi pi-angle-double-up",onClick:h,disabled:a.value},null,8,["disabled"])):c("",!0)]),s("div",oe,[o.value?(n(),_(m,{key:0,label:"Reply",class:"button-grey",icon:"pi pi-reply",onClick:q,disabled:t(e)===void 0},null,8,["disabled"])):c("",!0)]),s("div",le,[o.value?(n(),_(m,{key:0,label:"Skip Next",class:"button-grey",icon:"pi pi-step-forward-alt",onClick:M,disabled:t(e)===void 0},null,8,["disabled"])):c("",!0)])])]),s("div",te,[s("div",ae,[i(D,{class:j(["text-sm border-round-xl font-italic font-light mr-1",o.value?"bg-success":"bg-error"])},{default:Q(()=>[A(G(o.value?"Subscribed":"Unsubscribed"),1)]),_:1},8,["class"])])])]),t(e)?(n(),f("div",ne,[s("div",ie,[t(e).requestId!==""?(n(),f("div",ce,[s("div",de,[s("div",re,[i(v,{label:"Request Id",value:t(e).requestId},null,8,["value"])]),s("div",ue,[i(v,{label:"Timestamp",value:N(t(e).timestamp)},null,8,["value"])])]),s("div",pe,[i(v,{label:"Metadata",value:t(e).metadata},null,8,["value"])]),s("div",me,[i(v,{label:"Tags",value:t(e).tags},null,8,["value"])]),s("div",ve,[i(R,{label:"Body",value:t(e).body,styleProp:"height: 32vh"},null,8,["value"])])])):c("",!0)])])):c("",!0)])}}});export{xe as _};
