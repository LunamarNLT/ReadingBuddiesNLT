import J from"./InputText.63c92f00.js";import K from"./InputDropbox.88dd0d8b.js";import Q from"./InputNumber.c78c294d.js";import W from"./InputCalander.1fd5a583.js";import{u as X}from"./useToastMessage.5053bbd0.js";import{a as Z,Q as ee,e as te,s as d,M as se,o as a,f as i,h as o,i as n,q as u,l as I,c as k,u as p,a2 as D,w as m,R as q,t as b,r as N}from"./entry.53b34a98.js";import{c as le,d as ae}from"./stream.38699bf4.js";import{h as oe}from"./StatStripCard.vue_vue_type_style_index_0_scoped_b87ef05f_lang.52c9345e.js";import{_ as ne}from"./ReceivedMessage.vue_vue_type_script_setup_true_lang.d4d553ab.js";const de={class:"grid-nogutter grid col-12 p-0"},ie={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},re={class:"flex flex-grow-1 align-items-end p-0"},ue={class:"align-items-end grid p-fluid col-11 pb-0 mb-1"},ce={class:"col-12 md:col-2 pt-0"},me={key:0,class:"col-12 md:col-2"},ve={key:2,class:"col-12 md:col-2 pt-0"},pe={key:3,class:"col-12 md:col-2 pt-0"},be={key:4,class:"col-12 md:col-2 pt-0"},_e={class:"col-12 md:col-2 pt-0"},ye={class:"col-12 md:col-2 pt-0"},ge={class:"mb-3"},he={class:"flex justify-content-end",style:{"min-width":"10rem"}},fe={key:0,class:"col-12 md:12 pt-1"},we={key:0,class:"white-space-nowrap overflow-hidden text-overflow-ellipsis",style:{width:"13em"}},Se={key:1},ke=o("code",{class:"text-grey font-italic"},"N/A",-1),xe=[ke],Ve={key:0,class:"white-space-nowrap overflow-hidden text-overflow-ellipsis",style:{width:"30em"}},Me={class:"text-overflow-ellipsis"},Ce={key:1},De=o("code",{class:"text-grey font-italic"},"No Body",-1),Ne=[De],Be=Z({__name:"ChannelSubscribe",props:{channel:{type:String,default:()=>""},type:{type:String,default:()=>""}},setup(v){const g=v;ee(()=>{r.value=[],C.value=null,l.value&&P()});const U=te(),{ApiBaseHost:$}=le();let r=d([]),f=se({});const l=d(!1),c=d(!1),w=d(""),S=d(""),F=X(),_=d("none"),x=d(1),V=d(new Date),M=d(5),L=d([{label:"No Replay",value:"none"},{label:"First Message",value:"first"},{label:"Last Message",value:"last"},{label:"Sequence Number",value:"sequence"},{label:"Since Time",value:"time"},{label:"Time Delta",value:"delta"}]),R=()=>{let t=`channel=${g.channel}`;if(g.type==="events")t+="&subscribe_type=events";else{if(t+="&subscribe_type=events_store",S.value===""){const s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);t+=`&client_id=${s}`}else t+=`&client_id=${S.value}`;switch(_.value){case"none":t+="&events_store_type_data=1";break;case"first":t+="&events_store_type_data=2";break;case"last":t+="&events_store_type_data=3";break;case"sequence":t+=`&events_store_type_data=4&events_store_type_value=${x.value}`;break;case"time":t+=`&events_store_type_data=5&events_store_type_value=${V.value.toISOString()}`;break;case"delta":t+=`&events_store_type_data=6&events_store_type_value=${M.value}`;break}}return w.value!==""&&(t+=`&group=${w.value}`),`ws://${$.value}/api/subscribe/pubsub?${t}`},B=()=>{f=ae(R(),{autoClose:!1,immediate:!1,onConnected:()=>{l.value=!0,c.value=!1,r.value=[]},onDisconnected:()=>{l.value=!1,c.value=!1},onError:(t,s)=>{l.value=!1,c.value=!1,F.showError("Error occurred while subscribing to channel "+g.type+":"+g.channel)},onMessage:(t,s)=>{l.value=!0,c.value=!1;const h=JSON.parse(s.data);h.index=r.value.length+1,r.value.push(h)}}),c.value=!0,f.open()},P=()=>{c.value=!1,f&&f.close()},E=()=>{r.value=[]},C=d(),O=t=>{Y(t.index)},Y=t=>{U.open(ne,{props:{header:g.type==="events"?"View PubSub Events Message":"View PubSub Events-Store Message",style:{width:"65vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:r.value[t]}})},A=t=>t===0?"N/A":oe(t).format("YYYY-MM-DD HH:mm:ss");return(t,s)=>{const h=J,H=K,T=Q,G=W,j=N("Tag"),y=N("Column"),z=N("DataTable");return a(),i("div",de,[o("div",ie,[o("div",re,[o("div",ue,[o("div",ce,[n(h,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),label:"Set Group Name",disabled:l.value,placeholder:"No Group"},null,8,["modelValue","disabled"])]),v.type!=="events"?(a(),i("div",me,[n(h,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=e=>S.value=e),label:"Set Client Id",disabled:l.value,placeholder:"Random Client id"},null,8,["modelValue","disabled"])])):u("",!0),v.type!=="events"?(a(),i("div",{key:1,class:I(["col-12 md:col-2 pt-0",l.value?"div-disabled":""])},[n(H,{label:"Replay From",modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e),options:L.value},null,8,["modelValue","options"])],2)):u("",!0),_.value==="sequence"&&v.type!=="events"?(a(),i("div",ve,[n(T,{modelValue:x.value,"onUpdate:modelValue":s[3]||(s[3]=e=>x.value=e),label:"Set Message Sequence",disabled:l.value,min:1},null,8,["modelValue","disabled"])])):u("",!0),_.value==="time"&&v.type!=="events"?(a(),i("div",pe,[n(G,{modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=e=>V.value=e),label:"Time Since",disabled:l.value},null,8,["modelValue","disabled"])])):u("",!0),_.value==="delta"&&v.type!=="events"?(a(),i("div",be,[n(T,{modelValue:M.value,"onUpdate:modelValue":s[5]||(s[5]=e=>M.value=e),label:"Set Delta Seconds",disabled:l.value},null,8,["modelValue","disabled"])])):u("",!0),o("div",_e,[l.value?u("",!0):(a(),k(p(D),{key:0,label:"Subscribe",class:"button-grey",icon:"pi pi-angle-double-down",onClick:B,disabled:c.value},null,8,["disabled"])),l.value?(a(),k(p(D),{key:1,label:"Unsubscribe",class:"button-grey",icon:"pi pi-angle-double-up",onClick:P,disabled:c.value},null,8,["disabled"])):u("",!0)]),o("div",ye,[l.value?(a(),k(p(D),{key:0,label:"Clear",class:"button-grey",icon:"pi pi-trash",onClick:E,disabled:p(r).length===0},null,8,["disabled"])):u("",!0)])])]),o("div",ge,[o("div",he,[n(j,{class:I(["text-sm border-round-xl font-italic font-light mr-1",l.value?"bg-success":"bg-error"])},{default:m(()=>[q(b(l.value?"Subscribed":"Unsubscribed"),1)]),_:1},8,["class"])])])]),p(r).length>0?(a(),i("div",fe,[n(z,{value:p(r),paginator:p(r).length>25,rows:25,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[25,50,100],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Messages",responsiveLayout:"scroll",class:"p-datatable-sm",dataKey:"messageId",onRowSelect:O,selection:C.value,"onUpdate:selection":s[6]||(s[6]=e=>C.value=e),selectionMode:"single"},{default:m(()=>[n(y,{header:"#",headerStyle:"width: 1rem"},{body:m(({index:e})=>[q(b(e+1),1)]),_:1}),v.type!=="events"?(a(),k(y,{key:0,header:"Sequence",field:"sequence",sortable:"",headerStyle:"width:4em"},{body:m(({data:e})=>[o("div",null,b(e.sequence),1)]),_:1})):u("",!0),n(y,{header:"Timestamp",sortable:"",headerStyle:"width:8em"},{body:m(({data:e})=>[o("div",null,b(A(e.timestamp)),1)]),_:1}),n(y,{header:"Message Id",field:"messageId",sortable:"",headerStyle:"width:15em"},{body:m(({data:e})=>[o("div",null,b(e.messageId),1)]),_:1}),n(y,{header:"Metadata",field:"metadata",headerStyle:"width:13em"},{body:m(({data:e})=>[e.metadata?(a(),i("div",we,[o("code",null,b(e.metadata),1)])):(a(),i("div",Se,xe))]),_:1}),n(y,{header:"Body",field:"body",headerStyle:"width:30em"},{body:m(({data:e})=>[e.body?(a(),i("div",Ve,[o("code",Me,b(e.body),1)])):(a(),i("div",Ce,Ne))]),_:1})]),_:1},8,["value","paginator","selection"])])):u("",!0)])}}});export{Be as _};
