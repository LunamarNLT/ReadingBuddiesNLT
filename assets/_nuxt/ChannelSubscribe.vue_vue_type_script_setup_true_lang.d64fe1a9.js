import $ from"./InputText.dcc834c4.js";import{_ as F}from"./Field.vue_vue_type_script_setup_true_lang.b171eb6f.js";import{_ as U}from"./DataField.vue_vue_type_script_setup_true_lang.7f783943.js";import{u as E}from"./useToastMessage.d880f1b4.js";import{a as I,Q as Y,e as H,s as b,M as Q,o as n,f,h as s,i,c as _,q as c,u as t,w as A,R as G,t as W,l as j,r as y}from"./entry.e4fef673.js";import{c as z,d as J}from"./stream.7512440b.js";import{m as L}from"./StatStripCard.vue_vue_type_style_index_0_scoped_b87ef05f_lang.90af4798.js";import O from"./ReplyCommandMessage.8e116729.js";import P from"./ReplyQueryMessage.4fc9d267.js";const K={class:"grid-nogutter grid col-12 p-0"},X={class:"flex align-items-end col-12 md:12 align-content-between mb-1 pt-0 border-bottom-1 border-light-grey"},Z={class:"flex flex-grow-1 align-items-end p-0"},ee={class:"align-items-end grid p-fluid col-11 pb-0 mb-1"},se={class:"col-12 md:col-2 pt-0"},oe={class:"col-12 md:col-2 pt-0"},le={class:"col-12 md:col-2 pt-0"},te={class:"col-12 md:col-2 pt-0"},ae={class:"mb-3"},ne={class:"flex justify-content-end",style:{"min-width":"10rem"}},ie={key:0,class:"col-12 md:12 pt-3"},ce={class:"pt-0 pl-1 pr-1 pb-3 mt-2"},de={key:0,class:"grid formgrid p-fluid mt-3"},re={class:"grid formgrid p-fluid col-12 md:col-12 p-1"},ue={class:"col-12 md:col-6"},pe={class:"col-12 md:col-6"},me={class:"col-12 md:col-6 p-1"},ve={class:"col-12 md:col-6 p-1"},be={class:"col-12 md:col-12 p-1"},xe=I({__name:"ChannelSubscribe",props:{channel:{type:String,default:()=>""},type:{type:String,default:()=>""}},setup(k){const r=k;Y(()=>{e.value=void 0,o.value&&h()});const g=H(),{ApiBaseHost:w,BaseWebSocket:C}=z();let e=b(void 0),u=Q({});const o=b(!1),a=b(!1),p=b(""),S=E(),x=()=>{let l=`channel=${r.channel}`;return r.type==="commands"?l+="&subscribe_type=commands":l+="&subscribe_type=queries",p.value!==""&&(l+=`&group=${p.value}`),`${C.value}${w.value}/api/subscribe/cqrs?${l}`},M=()=>{u=J(x(),{autoClose:!1,immediate:!1,onConnected:()=>{o.value=!0,a.value=!1,e.value=void 0},onDisconnected:()=>{o.value=!1,a.value=!1},onError:(l,d)=>{o.value=!1,a.value=!1,S.showError("Error occurred while subscribing to channel "+r.type+":"+r.channel)},onMessage:(l,d)=>{o.value=!0,a.value=!1,e.value=JSON.parse(d.data)}}),a.value=!0,u.open()},h=()=>{a.value=!1,u&&u.close()},q=()=>{e.value=void 0},B=()=>{e.value.isCommand?g.open(O,{props:{header:"Reply Command",style:{width:"30vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:e.value},onClose:()=>{e.value=void 0}}):g.open(P,{props:{header:"Reply Query",style:{width:"50vw"},breakpoints:{"960px":"75vw","640px":"90vw"},modal:!0},data:{message:e.value},onClose:()=>{e.value=void 0}})},N=l=>l===0?"N/A":L(l).format("YYYY-MM-DD HH:mm:ss");return(l,d)=>{const D=$,m=y("Button"),R=y("Tag"),v=F,T=U;return n(),f("div",K,[s("div",X,[s("div",Z,[s("div",ee,[s("div",se,[i(D,{modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=V=>p.value=V),label:"Set Group Name",disabled:o.value,placeholder:"No Group"},null,8,["modelValue","disabled"])]),s("div",oe,[o.value?c("",!0):(n(),_(m,{key:0,label:"Subscribe",class:"button-grey",icon:"pi pi-angle-double-down",onClick:M,disabled:a.value},null,8,["disabled"])),o.value?(n(),_(m,{key:1,label:"Unsubscribe",class:"button-grey",icon:"pi pi-angle-double-up",onClick:h,disabled:a.value},null,8,["disabled"])):c("",!0)]),s("div",le,[o.value?(n(),_(m,{key:0,label:"Reply",class:"button-grey",icon:"pi pi-reply",onClick:B,disabled:t(e)===void 0},null,8,["disabled"])):c("",!0)]),s("div",te,[o.value?(n(),_(m,{key:0,label:"Skip Next",class:"button-grey",icon:"pi pi-step-forward-alt",onClick:q,disabled:t(e)===void 0},null,8,["disabled"])):c("",!0)])])]),s("div",ae,[s("div",ne,[i(R,{class:j(["text-sm border-round-xl font-italic font-light mr-1",o.value?"bg-success":"bg-error"])},{default:A(()=>[G(W(o.value?"Subscribed":"Unsubscribed"),1)]),_:1},8,["class"])])])]),t(e)?(n(),f("div",ie,[s("div",ce,[t(e).requestId!==""?(n(),f("div",de,[s("div",re,[s("div",ue,[i(v,{label:"Request Id",value:t(e).requestId},null,8,["value"])]),s("div",pe,[i(v,{label:"Timestamp",value:N(t(e).timestamp)},null,8,["value"])])]),s("div",me,[i(v,{label:"Metadata",value:t(e).metadata},null,8,["value"])]),s("div",ve,[i(v,{label:"Tags",value:t(e).tags},null,8,["value"])]),s("div",be,[i(T,{label:"Body",value:t(e).body,styleProp:"height: 32vh"},null,8,["value"])])])):c("",!0)])])):c("",!0)])}}});export{xe as _};
